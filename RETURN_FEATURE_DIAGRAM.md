# SÆ¡ Ä‘á»“ Luá»“ng Chá»©c nÄƒng Tráº£ MÃ³n

## 1. Kiáº¿n trÃºc Tá»•ng quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SUPABASE                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  order_items         â”‚  â”‚  return_notifications    â”‚   â”‚
â”‚  â”‚  - id                â”‚  â”‚  - id                    â”‚   â”‚
â”‚  â”‚  - order_id          â”‚  â”‚  - order_id              â”‚   â”‚
â”‚  â”‚  - status            â”‚  â”‚  - table_name            â”‚   â”‚
â”‚  â”‚  - customizations    â”‚  â”‚  - item_names[]          â”‚   â”‚
â”‚  â”‚  - quantity          â”‚  â”‚  - status                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  - created_at            â”‚   â”‚
â”‚           â†• Realtime       â”‚  - acknowledged_at       â”‚   â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â†• Realtime             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†•                                  â†•
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   KITCHEN    â”‚                  â”‚    STAFF     â”‚
    â”‚   (Báº¿p)      â”‚                  â”‚  (NhÃ¢n viÃªn) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. Luá»“ng Tráº£ MÃ³n Chi Tiáº¿t

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   KITCHEN    â”‚
â”‚ DisplayScreenâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Báº¥m nÃºt "TRáº¢ MÃ“N"
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  handleReturnOrderâ”‚
â”‚  - Show Alert     â”‚
â”‚  - Confirm?       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Yes
       â”‚ 2. Insert vÃ o return_notifications
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SUPABASE                â”‚
â”‚  return_notifications    â”‚
â”‚  {                       â”‚
â”‚    order_id: "...",      â”‚
â”‚    table_name: "BÃ n 1",  â”‚
â”‚    item_names: [...],    â”‚
â”‚    status: "pending"     â”‚
â”‚  }                       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 3. Realtime broadcast
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ReturnNotificationScreenâ”‚ â† STAFF
â”‚  - Nháº­n event má»›i        â”‚
â”‚  - fetchNotifications()   â”‚
â”‚  - previousCount < newCount?â”‚
â”‚    â†’ Vibration.vibrate() â”‚
â”‚  - Hiá»ƒn thá»‹ thÃ´ng bÃ¡o    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 4. Staff xá»­ lÃ½
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Báº¥m "ÄÃ£ xá»­ lÃ½"   â”‚
â”‚ handleAcknowledge â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 5. Update status = 'acknowledged'
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SUPABASE UPDATE     â”‚
â”‚  status: "acknowledged"â”‚
â”‚  acknowledged_at: NOW()â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3. Auto-hide Order Khi HoÃ n ThÃ nh

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  order_items     â”‚
â”‚  status changes  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Realtime update
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ KitchenDisplayScreen   â”‚
â”‚ fetchKitchenOrders()   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Filter orders
         â”‚
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Kiá»ƒm tra má»—i order:   â”‚
    â”‚ allServed = items.everyâ”‚
    â”‚   (item => status === â”‚
    â”‚    'served')          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
        â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
        â”‚         â”‚
    allServed? allServed?
    = true    = false
        â”‚         â”‚
        â†“         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”
    â”‚ áº¨n   â”‚  â”‚ Hiá»‡n â”‚
    â”‚ orderâ”‚  â”‚ orderâ”‚
    â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜
```

## 4. Luá»“ng Phá»¥c Vá»¥ MÃ³n (ServeStatusScreen)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ServeStatusScreenâ”‚
â”‚ - Hiá»‡n danh sÃ¡ch â”‚
â”‚   mÃ³n theo statusâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Má»—i mÃ³n cÃ³ status:
       â”‚
       â”œâ”€â†’ waiting â†’ Icon time (gray)
       â”‚
       â”œâ”€â†’ in_progress â†’ Icon flame (orange)
       â”‚
       â”œâ”€â†’ completed â†’ NÃºt "PHá»¤C Vá»¤" (green)
       â”‚              â”‚
       â”‚              â”‚ Báº¥m
       â”‚              â†“
       â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚         â”‚ handleMarkAsServedâ”‚
       â”‚         â”‚ Update status =  â”‚
       â”‚         â”‚   'served'       â”‚
       â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â””â”€â†’ served â†’ Icon checkmark-done (blue)
                          â”‚
                          â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ Kiá»ƒm tra: Táº¥t cáº£ mÃ³n served?â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ Yes
                          â”‚
                          â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Alert +  â”‚
                    â”‚ Go Back  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 5. Badge ThÃ´ng BÃ¡o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  return_notifications     â”‚
â”‚  Filter: status='pending' â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Count
             â”‚
             â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Count  â”‚
        â”‚  > 0?  â”‚
        â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
            â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
     â”‚             â”‚
    Yes           No
     â”‚             â”‚
     â†“             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Hiá»‡n    â”‚   â”‚ áº¨n     â”‚
â”‚ Badge   â”‚   â”‚ Badge  â”‚
â”‚ [sá»‘]    â”‚   â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 6. CÃ¡c Tráº¡ng ThÃ¡i MÃ³n

```
waiting â†’ in_progress â†’ completed â†’ served
  (Chá»)    (Äang lÃ m)    (Sáºµn sÃ ng)  (ÄÃ£ phá»¥c vá»¥)
    â”‚          â”‚             â”‚            â”‚
    â”‚          â”‚             â”‚            â””â”€â†’ Order tá»± Ä‘á»™ng áº©n
    â”‚          â”‚             â”‚                (khi táº¥t cáº£ mÃ³n served)
    â”‚          â”‚             â”‚
    â”‚          â”‚             â””â”€â†’ CÃ³ thá»ƒ TRáº¢ MÃ“N
    â”‚          â”‚
    â”‚          â””â”€â†’ CÃ³ thá»ƒ TRáº¢ MÃ“N
    â”‚
    â””â”€â†’ CÃ³ thá»ƒ TRáº¢ MÃ“N
```

## 7. MÃ n hÃ¬nh Kitchen vÃ  Actions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         KitchenDisplayScreen                    â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  OrderTicketCard (BÃ n 1)          â”‚          â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚          â”‚
â”‚  â”‚  â”‚ Header: Table Name + Time   â”‚ â”‚          â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚          â”‚
â”‚  â”‚  â”‚ Body: Order Info + Items    â”‚ â”‚          â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚          â”‚
â”‚  â”‚  â”‚ Actions:                    â”‚ â”‚          â”‚
â”‚  â”‚  â”‚  [CHáº¾ BIáº¾N] [TRáº¢ MÃ“N]      â”‚ â”‚          â”‚
â”‚  â”‚  â”‚   (Orange)   (Green)        â”‚ â”‚          â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  OrderTicketCard (BÃ n 2)          â”‚          â”‚
â”‚  â”‚  ...                              â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        Báº¥m "TRáº¢ MÃ“N"
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ReturnNotificationScreen                â”‚
â”‚                                                 â”‚
â”‚  ğŸ”” ThÃ´ng bÃ¡o tráº£ mÃ³n              [Badge: 2]  â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ ğŸ”´ BÃ n 1              5 phÃºt trÆ°á»›câ”‚          â”‚
â”‚  â”‚ MÃ³n cáº§n tráº£:                      â”‚          â”‚
â”‚  â”‚  â€¢ CÃ  phÃª sá»¯a (x2)               â”‚          â”‚
â”‚  â”‚  â€¢ TrÃ  Ä‘Ã o (x1)                   â”‚          â”‚
â”‚  â”‚                                   â”‚          â”‚
â”‚  â”‚  [âœ“ ÄÃ£ xá»­ lÃ½]     [ğŸ—‘ï¸]           â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ âœ… BÃ n 3              2 giá» trÆ°á»›câ”‚          â”‚
â”‚  â”‚ MÃ³n cáº§n tráº£:                      â”‚          â”‚
â”‚  â”‚  â€¢ Sinh tá»‘ bÆ¡ (x1)               â”‚          â”‚
â”‚  â”‚                                   â”‚          â”‚
â”‚  â”‚  [âœ“ ÄÃ£ xá»­ lÃ½]     [ğŸ—‘ï¸]           â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 8. TÃ³m táº¯t Events

```
EVENT                    SOURCE              TARGET              ACTION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Báº¥m "TRáº¢ MÃ“N"           Kitchen             Supabase            INSERT
Realtime broadcast      Supabase            Staff App           NOTIFY + VIBRATE
Báº¥m "ÄÃ£ xá»­ lÃ½"          Staff               Supabase            UPDATE
MÃ³n served              Server              Supabase            UPDATE
All served              Supabase            Kitchen             HIDE ORDER
```
