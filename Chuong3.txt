CHƯƠNG 3 - THIẾT KẾ WEBSITE
Chương này trình bày chi tiết quá trình thiết kế hệ thống website thương mại điện tử cho cửa hàng cà phê, tập trung vào việc đảm bảo hiệu quả, tính trực quan, và khả năng mở rộng. Nội dung bao gồm:
•	Tổng quan về thiết kế: Mô tả mục tiêu và nguyên tắc thiết kế của hệ thống.
•	Sitemap: Cấu trúc điều hướng của website, giúp người dùng dễ dàng truy cập các chức năng.
•	User Case: Các trường hợp sử dụng, minh họa cách người dùng tương tác với hệ thống.
•	Phân quyền và chức năng: Xác định vai trò người dùng và các tính năng tương ứng.
•	Thiết kế cơ sở dữ liệu: Mô tả schema, bảng, và mối quan hệ để lưu trữ dữ liệu hiệu quả.
•	Sơ đồ luồng hoạt động: Minh họa quy trình xử lý từ giao diện đến Back-end và cơ sở dữ liệu.
•	Cấu trúc mã nguồn: Tổ chức mã nguồn để dễ bảo trì và mở rộng.
•	Thiết kế giao diện người dùng: Chi tiết về thiết kế UI/UX, bao gồm wireframe và nguyên tắc thiết kế.
3.1. TỔNG QUAN VỀ THIẾT KẾ
Website thương mại điện tử cho cửa hàng cà phê được thiết kế để cung cấp một nền tảng bán hàng trực tuyến và quản lý kinh doanh toàn diện, đáp ứng nhu cầu của cả khách hàng và quản trị viên. Hệ thống sử dụng mô hình Single Page Application (SPA), được xây dựng với ReactJS và Vite cho Front-end, NodeJS/Express.js cho Back-end, MySQL cho cơ sở dữ liệu, và Cloudinary cho quản lý hình ảnh. Các thư viện bổ sung như jsonwebtoken đảm bảo xác thực an toàn, và react-toastify cải thiện trải nghiệm người dùng thông qua thông báo trực quan.
Mục tiêu thiết kế:
•	Tính trực quan: Giao diện đơn giản, dễ sử dụng, phù hợp với mọi đối tượng khách hàng, từ người trẻ đến người lớn tuổi.
•	Hiệu suất cao: Tối ưu tốc độ tải trang (dưới 2 giây) và xử lý yêu cầu (dưới 100ms cho các API thông thường).
•	Khả năng mở rộng: Cấu trúc mã nguồn và cơ sở dữ liệu được thiết kế linh hoạt, dễ dàng thêm tính năng như tích hợp cổng thanh toán hoặc chương trình khách hàng thân thiết trong tương lai.
•	Bảo mật: Xác thực người dùng bằng JWT, mã hóa mật khẩu bằng bcrypt, và bảo vệ dữ liệu giao dịch.
•	Tính responsive: Giao diện tương thích trên mọi thiết bị (máy tính, điện thoại, máy tính bảng) nhờ Tailwind CSS.
Hệ thống được thiết kế dựa trên mô hình client-server, với Front-end xử lý giao diện, Back-end xử lý logic nghiệp vụ, và cơ sở dữ liệu lưu trữ thông tin. Các công cụ như Figma (thiết kế giao diện), MySQL Workbench (thiết kế cơ sở dữ liệu), và Postman (kiểm tra API) được sử dụng để đảm bảo tính chính xác và hiệu quả trong quá trình thiết kế.
3.2. SITEMAP
Sitemap mô tả cấu trúc điều hướng, đảm bảo người dùng truy cập các chức năng chính trong tối đa 2-3 lần nhấp chuột. Điều hướng được quản lý bằng react-router-dom, tận dụng SPA để chuyển trang mượt mà.
•	Cấu trúc Sitemap:
o	Trang chủ (Home, /): Hiển thị thông tin cửa hàng, sản phẩm nổi bật, khuyến mãi, và bài viết về văn hóa cà phê.
o	Trang sản phẩm (Products, /products): Liệt kê sản phẩm (cà phê, đồ uống, phụ kiện), hỗ trợ tìm kiếm và lọc.
o	Chi tiết sản phẩm (Product Detail, /products/:id): Thông tin chi tiết và nút “Thêm vào giỏ hàng”.
o	Giỏ hàng (Cart, /cart): Hiển thị sản phẩm đã chọn, tổng giá, và nút “Thanh toán”.
o	Thanh toán (Checkout, /checkout): Form nhập thông tin giao hàng và thanh toán (COD/MoMo).
o	Xác nhận đơn hàng (Thank You, /checkout/thank-you): Thông báo đặt hàng thành công.
o	MoMo Return (/checkout/momo-return): Trang trả về sau thanh toán MoMo.
o	Trang cá nhân (Profile, /profile): Quản lý thông tin tài khoản và lịch sử đơn hàng.
o	Lịch sử đơn hàng (Order History, /profile/orders): Hiển thị danh sách đơn hàng và trạng thái.
•	Trang quản trị (Admin Dashboard, /admin): Yêu cầu xác thực JWT, bao gồm:
o	Quản lý sản phẩm (/admin/products): CRUD sản phẩm.
o	Quản lý đơn hàng (/admin/orders): Xem và cập nhật trạng thái đơn hàng.
o	Quản lý khách hàng (/admin/users): Xem danh sách người dùng.
o	Quản lý liên hệ (/admin/contacts): Xem và trả lời liên hệ.
o	Quản lý tin tức (/admin/news): CRUD bài viết.
o	Trang tin tức (News, /news): Danh sách bài viết.
o	Chi tiết tin tức (News Detail, /news/:id): Nội dung bài viết cụ thể.
o	Trang liên hệ (Contact, /contact): Form liên hệ và thông tin cửa hàng.
o	Trang khôi phục mật khẩu (Forgot Password, /forgot-password): Nhập email, mã xác nhận, và đặt lại mật khẩu.
o	Trang giới thiệu (About): Giới thiệu về cửa hàng, sứ mệnh và giá trị cốt lõi.
Sitemap được thiết kế với cấu trúc phẳng, tối ưu cho SEO (ví dụ, URL ngắn gọn như /products/coffee) và trải nghiệm người dùng. Các trang quản trị được bảo vệ bằng middleware xác thực, đảm bảo chỉ người dùng có vai trò admin hoặc staff mới truy cập được.
3.3. USE CASE
Use Case mô tả các trường hợp sử dụng chính của hệ thống, minh họa cách các đối tượng (khách hàng, nhân viên, quản trị viên) tương tác với website thông qua các chức năng cụ thể. Mỗi trường hợp được thiết kế để đáp ứng nhu cầu thực tiễn của cửa hàng cà phê, từ việc mua sắm trực tuyến đến quản lý kinh doanh. Các API được gọi thông qua Express.js, dữ liệu được lưu trong MySQL, hình ảnh được quản lý bởi Cloudinary, và thông báo được hiển thị bằng react-toastify. Dưới đây là chi tiết các trường hợp sử dụng, bao gồm cả những tính năng chưa được triển khai trong mã nguồn hiện tại.
 
Hình 3.2.  Sơ đồ Use Case của hệ thống
3.3.1. Khách Hàng (Customer)
3.3.1.1. Đăng Ký Tài Khoản
Mô tả: Khách hàng tạo tài khoản tại /register (component Register).
Quy trình:
•	Nhập username, email, password, fullname qua form.
•	Gửi POST đến /api/register:
•	Back-end kiểm tra tính duy nhất của email và username trong bảng users. Mật khẩu được mã hóa bằng bcrypt (10 salt rounds) và lưu:
•	Nếu trùng email hoặc username, trả về lỗi 409: “Username or email already exists”.
•	react-toastify hiển thị: “Đăng ký thành công!” hoặc “Email đã tồn tại!”.
•	Chưa triển khai: Gửi email xác nhận qua nodemailer
Kết quả: Tài khoản được tạo với vai trò user (customer).
3.3.1.2. Đăng Nhập
Mô tả: Khách hàng đăng nhập tại /login (component Login).
Quy trình:
•	Nhập email và password, gửi POST đến /api/login.
•	Back-end kiểm tra email trong bảng users, so sánh mật khẩu với bản mã hóa bằng bcrypt.
•	Nếu hợp lệ, tạo JWT (hết hạn sau 1 giờ) chứa id, username, role:
•	JWT lưu trong localStorage, gửi trong header Authorization: Bearer <token> cho các yêu cầu sau
•	react-toastify hiển thị: “Đăng nhập thành công!”.
Kết quả: Người dùng truy cập các tính năng cá nhân hóa (giỏ hàng, lịch sử đơn hàng).
3.3.1.3. Xem Sản Phẩm
Mô tả: Khách hàng duyệt sản phẩm tại /products (component SanPham).
Quy trình:
•	Gửi GET đến /api/products để lấy danh sách từ bảng products:
•	Dữ liệu bao gồm: id, name, price, original, description, image (Cloudinary URL), sale, short_description, sku, category, tags.
•	Component SanPham render lưới sản phẩm (Tailwind CSS: grid grid-cols-3 gap-4).
•	Chưa triển khai: Lọc theo danh mục, giá, hoặc đánh giá.
Kết quả: Danh sách sản phẩm hiển thị với hình ảnh tối ưu từ Cloudinary.
3.3.1.4. Xem Chi Tiết Sản Phẩm
Mô tả: Khách hàng xem chi tiết tại /products/:id (component ProductDetail).
Quy trình:
•	Gửi GET đến /api/products/:id:
•	Hiển thị thông tin: name, price, description, image, category, sale.
•	Nút “Thêm vào giỏ hàng” gửi POST đến /api/cart/add:
•	react-toastify hiển thị: “Đã thêm [name] vào giỏ hàng!”.
Kết quả: Khách hàng xem chi tiết và thêm sản phẩm vào giỏ hàng.
3.3.1.5. Quản Lý Giỏ Hàng
Mô tả: Khách hàng quản lý giỏ hàng tại /cart (component Cart).
Quy trình:
•	Thêm sản phẩm: POST /api/cart/add, kiểm tra sản phẩm trong bảng products hoặc cafe, thêm hoặc cập nhật bảng cart:
•	Xem giỏ hàng: GET /api/cart/select, lấy danh sách từ bảng cart, join với products hoặc cafe:
•	Chỉnh sửa số lượng: PUT /api/cart/:id:
•	Xóa sản phẩm: DELETE /api/cart/:id:
•	react-toastify hiển thị thông báo: “Đã cập nhật giỏ hàng!” hoặc “Đã xóa sản phẩm!”.
Kết quả: Giỏ hàng được quản lý tức thời, với giao diện thân thiện.
3.3.1.6. Thanh Toán
Mô tả: Khách hàng hoàn tất đơn hàng tại /checkout (component Checkout).
Quy trình:
•	Nhập thông tin: fullname, email, phone, address, note, chọn phương thức thanh toán (COD/MoMo).
•	Thanh toán COD:
o	Gửi POST /api/orders/create-cod:
o	Back-end tạo đơn hàng trong orders và order_items, xóa giỏ hàng:
o	Gửi email xác nhận qua sendReceiptEmail (HTML template trong sendMailHelper.js).
o	Tạo thông báo trong bảng notifications:
o	Chuyển hướng đến /checkout/thank-you (component ThankYouPage).
o	react-toastify hiển thị: “Đặt hàng thành công! Mã đơn hàng: #ORD123”.
•	Thanh toán MoMo:
o	Gửi POST đến /momo/create (momoPayment.js), tạo URL thanh toán:

o	MoMo gọi lại /momo/verify-and-send-mail để xác minh:
	Nếu resultCode == 0, tạo đơn hàng với payment_status: paid, order_status: processing.
	Nếu thất bại, tạo đơn hàng với payment_status: failed, order_status: cancelled, lưu lý do hủy.
	Gửi email xác nhận hoặc hủy qua sendReceiptEmail hoặc sendCancellationEmail.
o	Chuyển hướng đến /checkout/momo-return (component MomoReturn).
Kết quả: Đơn hàng được tạo, khách hàng nhận thông báo và email xác nhận.
3.3.1.7. Xem Lịch Sử Đơn Hàng
Mô tả: Khách hàng xem đơn hàng tại /profile/orders (component UserOrderDetail).
Quy trình:
•	Gửi GET đến /api/order/:orderCode, kiểm tra quyền qua user_id trong JWT:
•	Hủy đơn hàng: Trong 10 phút (order_status: processing), gửi PUT /api/orders/user-cancel/:orderId
o	Gửi email hủy qua sendCancellationEmail.
o	Tạo thông báo trong notifications.
•	react-toastify hiển thị: “Đã hủy đơn hàng thành công!”.
Kết quả: Khách hàng xem được chi tiết đơn hàng và hủy nếu đủ điều kiện.
3.3.1.8. Xem Tin Tức
Mô tả: Khách hàng truy cập /news (component AllNewsPage) hoặc /news/:id (component NewspaperDetail).
Quy trình:
•	Gửi GET /api/news để lấy danh sách bài viết:
•	Gửi GET /api/news/:id cho chi tiết bài viết:


Kết quả: Khách hàng đọc tin tức về cửa hàng hoặc khuyến mãi.
3.3.1.9. LIÊN HỆ
Mô tả: Khách hàng gửi liên hệ qua /contact (component Contact).
Quy trình:
•	Gửi POST /api/contact/send:
•	Lưu vào bảng contacts:
•	Gửi email xác nhận cho khách hàng và thông báo cho admin qua sendMailHelper.js.
•	react-toastify hiển thị: “Gửi liên hệ thành công!”.
Kết quả: Thông tin liên hệ được lưu và gửi đến admin.
3.3.1.10. Thông Báo
Mô tả: Khách hàng xem thông báo tại /notifications.
	Quy trình:
•	Gửi GET /api/notifications để lấy 20 thông báo gần nhất:
•	Đánh dấu đã đọc: POST /api/notifications/:id/mark-one-read hoặc /api/notifications/mark-read:
•	Thông báo tự động tạo khi đặt hàng, hủy đơn, hoặc cập nhật trạng thái.
Kết quả: Khách hàng nhận thông báo kịp thời.
3.3.1.11. Đặt Lại Mật Khẩu
Mô tả: Khách hàng khôi phục mật khẩu tại /forgot-password.
Quy trình:
•	Gửi POST /api/request-password-reset với email, tạo mã xác nhận (6 chữ số, hiệu lực 5 phút):
•	Gửi email mã xác nhận qua sendMailHelper.js.
•	Xác minh mã: POST /api/verify-reset-code.
•	Đặt lại mật khẩu: POST /api/reset-password, cập nhật password bằng bcrypt:
•	react-toastify hiển thị: “Đặt lại mật khẩu thành công!”.
Kết quả: Khách hàng khôi phục được tài khoản.
3.3.2. Quản Trị Viên (Admin)
Mô tả: Quản trị viên quản lý toàn hệ thống qua /admin (component AdminDashboard).
Quy trình:
•	Quản lý sản phẩm:
o	Xem danh sách: GET /api/products.
o	Thêm sản phẩm: POST /api/products, upload hình ảnh qua multer và Cloudinary:
o	Nhập hàng loạt: POST /api/products/import với CSV, sử dụng ảnh placeholder nếu thiếu.
o	Cập nhật/xóa: PUT /api/products/:id, DELETE /api/products/:id.
•	Quản lý menu nước (Cafe):
o	Tương tự sản phẩm, sử dụng bảng cafe và endpoint /api/cafes, /api/cafes/:id.
•	Quản lý đơn hàng:
o	Xem danh sách: GET /api/orders, join với order_items, products, cafe.
o	Cập nhật trạng thái: PUT /api/orders/:id/status, gửi email hủy qua sendCancellationEmail nếu cancelled.
•	Quản lý liên hệ:
o	Xem danh sách: GET /api/contacts.
o	Trả lời: PUT /api/contacts/:id/reply, gửi email:
•	Quản lý khách hàng:
o	Xem danh sách: GET /api/admin/users.
o	Chưa triển khai: Cấp quyền/xóa tài khoản, đề xuất thêm PUT /api/admin/users/:id/role, DELETE /api/admin/users/:id.
•	Quản lý tin tức:
o	Xem danh sách/chi tiết: GET /api/news, /api/news/:id.
o	Thêm bài viết: POST /api/news:
•	Báo cáo doanh thu:
o	Chưa triển khai: Đề xuất endpoint /api/reports/revenue:

o	Xuất PDF/Excel: Đề xuất sử dụng jsPDF hoặc exceljs.
Kết quả: Admin quản lý toàn diện, với các endpoint bảo vệ bằng adminOnly.
3.4. PHÂN TÍCH THIẾT KẾ HỆ THỐNG (CLASS DIAGRAM)
 
Hình 3.3. Sơ đồ Class Diagram
	Sơ đồ lớp (Class Diagram) thể hiện cấu trúc logic của hệ thống thông qua các lớp thực thể (Model), lớp điều khiển (Controller) và lớp hỗ trợ (Helper), giúp xác định rõ vai trò, thuộc tính và mối quan hệ giữa các thành phần.
•	Các lớp thực thể (Models)
o	Các lớp chính bao gồm:
	Người Dùng: chứa thông tin xác thực, phân quyền (user/admin).
	Sản Phẩm, Đơn Hàng, Chi Tiết Đơn Hàng: thể hiện luồng mua sắm, đặt hàng.
	Tin Tức, Liên Hệ: hỗ trợ truyền thông và phản hồi từ người dùng.
o	Quan hệ giữa các lớp:
	Một Người Dùng có thể tạo nhiều Đơn Hàng.
	Mỗi Đơn Hàng chứa nhiều Chi Tiết Đơn Hàng, liên kết đến Sản Phẩm.
•	Các lớp điều khiển (Controllers)
o	Chịu trách nhiệm xử lý logic nghiệp vụ:
	QL_XacThucController: đăng ký, đăng nhập, khôi phục mật khẩu.
	QL_SanPhamController, QL_DonHangController: quản lý sản phẩm và đơn hàng.
	QL_AdminController: toàn quyền thao tác dữ liệu (CRUD) và phản hồi liên hệ.
•	Các lớp hỗ trợ (Helpers)
o	Các module kỹ thuật hỗ trợ xử lý bảo mật và dịch vụ ngoài:
	Hỗ Trợ Mật Khẩu: mã hóa và kiểm tra mật khẩu.
	Hỗ Trợ JWT: xác thực phiên đăng nhập bằng token.
	Hỗ Trợ Cloudinary: tải và xoá ảnh sản phẩm.
	Hỗ Trợ Gửi Mail: thông báo qua email.
	Thanh Toán MoMo: tạo URL thanh toán và xác minh phản hồi.
3.5. PHÂN TÍCH THIẾT KẾ HỆ THỐNG – SƠ ĐỒ TUẦN TỰ
	Sơ đồ tuần tự (Sequence Diagram) được sử dụng để mô hình hóa chuỗi tương tác giữa các đối tượng trong hệ thống theo thời gian. Các sơ đồ này giúp mô tả rõ trình tự gọi hàm, logic xử lý nghiệp vụ, và phân luồng tương tác giữa các thành phần trong hệ thống như khách hàng, giao diện người dùng, hệ thống backend, và các dịch vụ bên thứ ba.
3.5.1. Sơ đồ tuần tự – Đặt hàng
 
Hình 3.4. Sơ đồ đặt hàng
	Mô tả quá trình khách hàng thực hiện thao tác đặt hàng thành công hoặc thất bại từ giao diện website đến các hệ thống backend.
•	Khách hàng thêm sản phẩm vào giỏ và gửi yêu cầu đặt hàng.
•	Website gửi yêu cầu đến Hệ thống Đặt Hàng, sau đó xác thực thanh toán với Hệ thống Thanh Toán.
•	Nếu thanh toán thành công, hệ thống kiểm tra tồn kho và trừ số lượng trong Kho Hàng.
•	Sau khi tồn kho được xác nhận, thông tin đơn hàng được gửi đến Đơn Vị Giao Hàng để tiếp nhận vận chuyển.
•	Kết quả xử lý đơn hàng (thành công/thất bại) sẽ được phản hồi cho khách hàng thông qua website.
	Sơ đồ này thể hiện rõ tính tuần tự và phân nhánh giữa hai luồng xử lý: thanh toán thất bại (thông báo lỗi) và thanh toán thành công (xử lý đơn hàng hoàn chỉnh).
3.5.2. Sơ đồ tuần tự – Trả hàng
 
Hình 3.5. Sơ đồ trả hàng
	Mô tả quy trình khách hàng yêu cầu trả hàng, được duyệt bởi quản trị viên và xử lý hoàn tiền.
•	Khách hàng tạo yêu cầu trả hàng qua Giao Diện Hỗ Trợ, yêu cầu này được lưu và gửi đến Hệ Thống Hỗ Trợ.
•	Hệ thống gửi thông báo yêu cầu cần được quản lý duyệt.
•	Quản lý có thể duyệt hoặc từ chối yêu cầu:
o	Nếu từ chối: trạng thái cập nhật là “Từ chối”.
o	Nếu chấp thuận: khách hàng được hướng dẫn trả hàng, Kho Hàng xác nhận hàng hoàn, và Hệ Thống Kế Toán tạo lệnh hoàn tiền.
•	Sau khi hoàn tất, khách hàng nhận được thông báo hoàn tiền thành công.
	Sơ đồ cho thấy hệ thống hỗ trợ xử lý yêu cầu khách hàng một cách linh hoạt, đảm bảo tính xác minh qua nhiều cấp (quản lý, kho, kế toán).
3.6. PHÂN QUYỀN VÀ CHỨC NĂNG
Hệ thống phân quyền rõ ràng, sử dụng jsonwebtoken để kiểm soát truy cập dựa trên vai trò (user, staff, admin). Các chức năng được thiết kế để đáp ứng nhu cầu cụ thể của từng vai trò, với các endpoint được bảo vệ bằng middleware authenticateJWT và adminOnly.
3.6.1. Phân Quyền
Khách hàng (Customer, role: user):
•	Quyền truy cập: /, /products, /products/:id, /cart, /checkout, /checkout/thank-you, /checkout/momo-return, /profile, /profile/orders, /news, /news/:id, /contact, /forgot-password.
•	Hạn chế: Không truy cập /admin/* hoặc thông tin người dùng khác.
•	Xác thực: Yêu cầu JWT cho /api/cart/*, /api/orders/*, /api/notifications/*.
Quản trị viên (Admin, role: admin):
•	Quyền truy cập: Toàn bộ endpoint /api/admin/*, /api/products/*, /api/cafes/*, /api/orders/*, /api/contacts/*, /api/news/*.
•	Hạn chế: Không có.
•	Xác thực: Middleware adminOnly kiểm tra role: admin trong JWT.
3.6.2. Các Chức Năng Chính
Quản lý tài khoản:
•	Đăng ký: POST /api/register, mã hóa mật khẩu bằng bcrypt.
•	Đăng nhập: POST /api/login, trả về JWT.
•	Khôi phục mật khẩu: POST /api/request-password-reset, /api/verify-reset-code, /api/reset-password, gửi email qua nodemailer.
•	Cập nhật thông tin cá nhân: Chưa triển khai, đề xuất PUT /api/users/:id:
Quản lý sản phẩm:
•	Xem: GET /api/products, /api/cafes.
•	Thêm: POST /api/products, /api/cafes, upload hình ảnh qua Cloudinary.
•	Nhập hàng loạt: POST /api/products/import với CSV.
•	Cập nhật/xóa: PUT /api/products/:id, DELETE /api/products/:id, tương tự cho /api/cafes/*.
Quản lý giỏ hàng:
•	Thêm: POST /api/cart/add.
•	Xem/chỉnh sửa/xóa: GET /api/cart/select, PUT /api/cart/:id, DELETE /api/cart/:id.
•	Thông báo: react-toastify hiển thị phản hồi.
Quản lý đơn hàng:
•	Tạo: POST /api/orders/create-cod, /momo/verify-and-send-mail.
•	Xem: GET /api/order/:orderCode, GET /api/orders.
•	Cập nhật trạng thái: PUT /api/orders/:id/status, gửi email qua nodemailer.
•	Hủy: PUT /api/orders/user-cancel/:orderId (khách hàng), PUT /api/orders/:id/status (admin).
•	Chưa triển khai: Xuất PDF/Excel, đề xuất jsPDF hoặc exceljs.
Quản lý khách hàng:
•	Xem: GET /api/admin/users.
•	Chưa triển khai: Cấp quyền/xóa tài khoản, đề xuất PUT /api/admin/users/:id/role, DELETE /api/admin/users/:id.
Quản lý liên hệ:
•	Xem: GET /api/contacts.
•	Trả lời: PUT /api/contacts/:id/reply, gửi email qua nodemailer.
•	Cập nhật trạng thái: PUT /api/contacts/:id/status.
Quản lý tin tức:
•	Xem: GET /api/news, /api/news/:id.
•	Thêm: POST /api/news.
•	Chưa triển khai: Cập nhật trang giới thiệu/khuyến mãi, đề xuất bảng pages và endpoint /api/pages.
Quản lý thông báo:
•	Xem: GET /api/notifications.
•	Đánh dấu đã đọc: POST /api/notifications/:id/mark-one-read, /api/notifications/mark-read.
Báo cáo doanh thu:
•	Chưa triển khai: Đề xuất /api/reports/revenue và xuất PDF/Excel.
Tính năng chưa triển khai cần bổ sung cho sau này:
•	Lọc sản phẩm: Thêm query parameters cho /api/products.
•	Cập nhật thông tin cá nhân: Thêm PUT /api/users/:id.
•	Đánh giá sản phẩm: Thêm bảng reviews và endpoint /api/reviews.
•	Vai trò nhân viên: Thêm middleware staffOnly và endpoint /api/staff/*.
•	Báo cáo doanh thu: Thêm /api/reports/revenue và xuất PDF/Excel.
•	Email xác nhận đăng ký: Thêm logic trong /api/register.
•	Quản lý trang giới thiệu/khuyến mãi: Thêm bảng pages và endpoint /api/pages.
3.7. Thiết Kế Cơ Sở Dữ Liệu
Cơ sở dữ liệu được thiết kế bằng MySQL, sử dụng MySQL Workbench để tạo schema, bảng, và mối quan hệ, đảm bảo tính toàn vẹn dữ liệu và hiệu quả truy vấn. Sơ đồ ERD (Entity-Relationship Diagram) mô tả các bảng và quan hệ, dựa trên các bảng users, products, cafe, orders, order_items, cart, contacts, notifications, và news. Các bảng được liên kết qua khóa chính và khóa ngoại, hỗ trợ các chức năng như quản lý sản phẩm, đơn hàng, liên hệ, và tin tức. Dưới đây là mô tả chi tiết các bảng, bao gồm cấu trúc, ràng buộc, và dữ liệu mẫu từ cơ sở dữ liệu.



	Quan hệ giữa các bảng:
•	users (1-N) orders, cart, contacts, notifications.
•	orders (1-N) order_items.
•	products và cafe (1-N) order_items, cart.
3.7.1. Mô Tả Bảng Dữ Liệu
3.7.1.1. Bảng Users – Thông Tin Người Dùng
Lưu trữ thông tin về khách hàng, nhân viên, và quản trị viên.
Bảng 3.1. Bảng users
Cột	Kiểu dữ liệu	Mô tả
id	INT	Mã người dùng (khóa chính)
username	VARCHAR(45)	Tên người dùng
email	VARCHAR(100)	Email
password	VARCHAR(255)	Mật khẩu (mã hóa bằng bcrypt)
role	ENUM('admin','user')	Vai trò người dùng (admin/user)
fullname	VARCHAR(45)	Họ tên
entry_date	DATETIME	Ngày tạo tài khoản (nullable)
userscol	VARCHAR(45)	Cột dự phòng (nullable)
reset_code	VARCHAR(6)	Mã đặt lại mật khẩu (nullable)
reset_code_expires	DATETIME	Thời gian hết hạn mã (nullable)
Ràng buộc:
•	username và email là duy nhất.
•	password được mã hóa bằng bcrypt (10 salt rounds).
•	role chỉ hỗ trợ admin và user (thiếu staff so với tài liệu trước, cần thêm nếu triển khai vai trò nhân viên).
Dữ liệu mẫu:
Ví dụ truy vấn:
•	Kiểm tra email tồn tại khi đăng ký:


3.7.1.2. Bảng Products – Sản Phẩm
Lưu trữ thông tin về các sản phẩm như cà phê hạt, túi giấy, ly sứ.
Bảng 3.2. Bảng products
Cột	Kiểu dữ liệu	Mô tả
id	INT 	Mã sản phẩm (khóa chính)
name	VARCHAR(255)	Tên sản phẩm
price	INT 	Giá bán (VNĐ)
original	INT	Giá gốc (nullable)
sale	TINYINT(1)	Trạng thái khuyến mãi (0/1)
image	VARCHAR(255)	URL ảnh (Cloudinary, nullable)
description	TEXT	Mô tả sản phẩm (nullable)
short_description	VARCHAR(255)	Mô tả ngắn (nullable)
sku	VARCHAR(50)	Mã SKU (nullable)
category	VARCHAR(50)	Danh mục (nullable)
tags	VARCHAR(255)	Thẻ (nullable)
Ràng buộc:
•	name là duy nhất (dù không có ràng buộc UNIQUE trong schema hiện tại, nên thêm).
•	price không âm.
Dữ liệu mẫu:
Ví dụ truy vấn:
Lấy sản phẩm đang khuyến mãi:


3.7.1.3. Bảng Cafe – Menu Nước
Lưu trữ thông tin về các món đồ uống (cà phê, trà).
Bảng 3.3. Bảng cafe
Cột	Kiểu dữ liệu	Mô tả
id	INT	Mã món (khóa chính)
name	VARCHAR(100)	Tên món
img	VARCHAR(255)	URL ảnh (Cloudinary, nullable)
desc	VARCHAR(255)	Mô tả món
price	DECIMAL(10,2)	Giá bán (VNĐ)
Ràng buộc:
•	Không có ràng buộc UNIQUE trên name, nên thêm để tránh trùng lặp.
Dữ liệu mẫu:
Ví dụ truy vấn:
•	Lấy danh sách món cà phê:
3.7.1.4. Bảng Orders – Danh Sách Đơn Hàng
Quản lý danh sách đơn hàng của khách hàng.
Bảng 3.4. Bảng orders
Cột	Kiểu dữ liệu	Mô tả
id	INT 	Mã đơn hàng (khóa chính)
user_id	INT 	Mã người dùng (khóa ngoại)
order_code	VARCHAR(50) 	Mã đơn hàng duy nhất
fullname	VARCHAR(255) 	Họ tên khách hàng
email	VARCHAR(255) 	Email khách hàng
phone	VARCHAR(20) 	Số điện thoại
address	TEXT 	Địa chỉ giao hàng
note	TEXT	Ghi chú (nullable)
total_amount	DECIMAL(10,0) 	Tổng giá trị
payment_method	VARCHAR(50)	Phương thức thanh toán (cod/momo)
payment_status	ENUM('pending','paid','failed')	Trạng thái thanh toán
order_status	ENUM('processing','shipped','delivered','cancelled')	Trạng thái đơn hàng
order_date	TIMESTAMP	Ngày tạo đơn hàng
cancellation_reason	TEXT	Lý do hủy (nullable)
voucher_code	VARCHAR(20)	Mã voucher (nullable)
discount_amount	DECIMAL(10,2)	Số tiền giảm giá
Ràng buộc:
•	user_id là khóa ngoại liên kết với users(id).
•	order_code là duy nhất.
	Dữ liệu mẫu:
	Ví dụ truy vấn:
•	Lấy đơn hàng đã giao:
3.7.1.5. Bảng Order_Items – Chi Tiết Đơn Hàng
	Lưu trữ thông tin chi tiết về sản phẩm/món trong mỗi đơn hàng.
Bảng 3.5. Bảng order_items
Cột	Kiểu dữ liệu	Mô tả
id	INT 	Mã mục đơn hàng (khóa chính)
order_id	INT 	Mã đơn hàng (khóa ngoại)
product_id	INT 	Mã sản phẩm/món
product_type	VARCHAR(20) 	Loại sản phẩm (product/cafe)
product_name	VARCHAR(255) 	Tên sản phẩm/món
quantity	INT NOT NULL	Số lượng
price	DECIMAL(10,0) 	Giá tại thời điểm đặt
	Ràng buộc:
•	order_id liên kết với orders(id) với ON DELETE CASCADE.
•	product_id không có ràng buộc khóa ngoại với products hoặc cafe, nên thêm để đảm bảo toàn vẹn.
	Dữ liệu mẫu:
	Ví dụ truy vấn:
•	Lấy chi tiết đơn hàng:
3.7.1.6. Bảng Cart – Giỏ Hàng
	Lưu trữ sản phẩm/món trong giỏ hàng của người dùng.
Bảng 3.6. Bảng cart
Cột	Kiểu dữ liệu	Mô tả
cartid	INT 	Mã giỏ hàng (khóa chính)
id_cafe	INT	Mã món cà phê (nullable)
id_product	INT	Mã sản phẩm (nullable)
quantity	INT NOT NULL DEFAULT 1	Số lượng
type	ENUM('cafe','product') 	Loại sản phẩm
user_id	INT	Mã người dùng (nullable)
image	VARCHAR(255)	URL ảnh (Cloudinary, nullable)
cartid	INT 	Mã giỏ hàng (khóa chính)
	Ràng buộc:
•	UNIQUE KEY trên id_cafe, id_product, type để tránh trùng lặp.
•	user_id không có ràng buộc khóa ngoại, nên thêm liên kết với users(id).
Dữ liệu mẫu:
Ví dụ truy vấn:
•	Lấy giỏ hàng của người dùng:
3.7.1.7. Bảng Contacts – Liên Hệ
	Lưu trữ thông tin liên hệ từ khách hàng.
Bảng 3.7. Bảng contracts
Cột	Kiểu dữ liệu	Mô tả
id	INT 	Mã liên hệ (khóa chính)
name	VARCHAR(255) 	Tên người gửi
email	VARCHAR(255) 	Email người gửi
message	TEXT NOT NULL	Nội dung liên hệ
created_at	TIMESTAMP	Thời gian gửi
status	ENUM('new','read','replied')	Trạng thái liên hệ
admin_reply	TEXT	Phản hồi của admin (nullable)
replied_at	TIMESTAMP	Thời gian trả lời (nullable)
	Ràng buộc: Không có khóa ngoại, hay ràng buộc nào.
Dữ liệu mẫu:
Ví dụ truy vấn:
•	Lấy liên hệ chưa trả lời:

3.7.1.8. Bảng Notifications – Thông Báo
	Lưu trữ thông báo cho người dùng.
Bảng 3.8. Bảng notifications
Cột	Kiểu dữ liệu	Mô tả
id	INT	Mã thông báo (khóa chính)
user_id	INT	Mã người dùng (khóa ngoại)
message	TEXT 	Nội dung thông báo
link	VARCHAR(255)	Liên kết đến đơn hàng (nullable)
is_read	TINYINT(1) DEFAULT 0	Trạng thái đọc (0: chưa đọc, 1: đã đọc)
created_at	TIMESTAMP	Thời gian tạo
	Ràng buộc:
•	user_id liên kết với users(id).
Dữ liệu mẫu:
	Ví dụ truy vấn:
•	Lấy thông báo chưa đọc:
3.7.1.9. Bảng News – Tin Tức
Lưu trữ bài viết tin tức.
Bảng 3.9. Bảng news
Cột	Kiểu dữ liệu	Mô tả
id	INT 	Mã bài viết (khóa chính)
title	VARCHAR(255) 	Tiêu đề
category	VARCHAR(100)	Danh mục (nullable)
date	DATE	Ngày đăng (nullable)
description	TEXT	Mô tả ngắn (nullable)
content	TEXT	Nội dung bài viết (nullable)
image	VARCHAR(255)	URL ảnh (Cloudinary, nullable)
author	VARCHAR(100)	Tác giả (nullable)
	Ràng buộc: Không có khóa ngoại.
	Dữ liệu mẫu:
	Ví dụ truy vấn:
•	Lấy tin tức mới nhất:

3.8. SƠ ĐỒ LUỒNG HOẠT ĐỘNG
3.8.1. Luồng Mua Hàng Của Khách Hàng
•	Truy cập /, gửi GET /api/products, /api/cafe.
•	Thêm vào giỏ hàng: POST /api/cart/add.
•	Thanh toán: POST /api/orders/create-cod hoặc /momo/create, lưu orders, order_items, xóa cart.
•	Xem lịch sử: GET /api/order/:orderCode.
 
Hình 3.7. Sơ đồ luồng mua hàng
3.8.2. Luồng quản lý của admin
•	Đăng nhập: POST /api/login.
•	Quản lý sản phẩm: POST/PUT/DELETE /api/products/*, /api/cafes/*.
•	Quản lý đơn hàng: GET /api/orders, PUT /api/orders/:id/status.
•	Quản lý liên hệ: GET /api/contacts, PUT /api/contacts/:id/reply.
 
Hình 3.8. Sơ đồ luồng quản lý của admin
3.9. CẤU TRÚC MÃ NGUỒN
3.9.1. Front-end (ReactJS)
	Cấu trúc thư mục của front-end được tổ chức theo các component, page, và các chức năng riêng biệt để dễ dàng quản lý và bảo trì.
frontend/
├── public/                     # Chứa các file tĩnh, public
├── src/
│   ├── assets/                 # Chứa các tài nguyên tĩnh như logo, icon (react.svg)
│   ├── components/
│   │   ├── Admin/              # Components dành riêng cho trang quản trị
│   │   │   ├── AdminSidebar.jsx
│   │   │   ├── Orders.jsx
│   │   │   └── RevenueChartPage.jsx
│   │   ├── content/            # Components chứa nội dung chính của các trang
│   │   │   ├── AboutSection.jsx
│   │   │   ├── Cart.jsx
│   │   ├── context/            # Chứa các context API của React (ví dụ: ShopContext)
│   │   │   └── shopContext.jsx
│   │   ├── CSS/                # Chứa các file CSS riêng cho component
│   │   │   ├── HeroSection.css
│   │   │   └── Parallax.css
│   │   ├── Footer/             # Component Footer của trang
│   │   │   └── Footer.jsx
│   │   ├── Header/             # Component Header của trang
│   │   │   ├── Header.jsx
│   │   │   └── ...
│   │   ├── IMG/                # Chứa các hình ảnh sử dụng trong dự án
│   │   │   ├── Heros/
│   │   │   ├── Product/
│   │   │   └── ...
│   │   ├── page/               # Components đại diện cho một trang hoàn chỉnh
│   │   │   ├── Home.jsx
│   │   │   ├── Menu.jsx
│   │   │   ├── SanPham.jsx
│   │   │   ├── ProductDetail.jsx
│   │   │   ├── Contact.jsx
│   │   │   ├── ThanhToan.jsx
│   │   │   ├── ThankYouPage.jsx
│   │   │   ├── MomoReturn.jsx
│   │   │   ├── VnpayReturn.jsx
│   │   │   └── UserOrderDetail.jsx
│   │   └── router/             # Chứa cấu hình định tuyến (routes) cho ứng dụng
│   │       ├── router.jsx
│   │       └── ScrollToTop.jsx
│   ├── App.jsx                 # Component gốc, chứa logic định tuyến chính
│   ├── index.css               # File CSS toàn cục
│   └── main.jsx                # Điểm khởi đầu của ứng dụng React
├── package.json                # Chứa thông tin và các dependencies của dự án
└── ...                         # Các file cấu hình khác (vite.config.js, tailwind.config.js, ...)
3.9.2.  Back-end (NodeJS/Express.js)
	Cấu trúc thư mục của back-end được thiết kế để phân tách các mối quan tâm (separation of concerns), bao gồm cấu hình, logic xử lý, và các file tiện ích.
backend/
├── config/                     # Chứa các file cấu hình cho ứng dụng
│   └── default.json            # Cấu hình mặc định (ví dụ: port, chuỗi kết nối DB)
├── uploads/                    # Thư mục lưu trữ các file được người dùng tải lên
├── .env                        # Lưu trữ các biến môi trường nhạy cảm
├── server.js       # File khởi động chính của server, thiết lập Express và các middleware
├── momoPayment.js              # Chứa logic xử lý thanh toán qua Momo
├── vnpayPayment.js             # Chứa logic xử lý thanh toán qua VNPay
├── sendMailHelper.js           # Helper để xử lý việc gửi email
├── package.json                # Chứa thông tin và các dependencies của dự án
└── ...                         # Các file và thư mục khác (routes, controllers, models,...).
